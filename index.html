<!DOCTYPE html>
let rollTimer = null;
let currentIndex = 0;


function initSystem() {
members = document.getElementById('staffList').value.trim().split('\n');


const lines = document.getElementById('prizeInput').value.trim().split('\n');
let temp = lines.map(l => {
const [id, name, count] = l.split('|');
return { id: +id, name, count: +count };
}).sort((a,b)=>b.id-a.id);


prizeQueue = [];
temp.forEach(p=>{ for(let i=0;i<p.count;i++) prizeQueue.push(p.name); });


currentIndex = 0;
document.getElementById('records').innerHTML = '';
updateDisplay();


alert('初始化完成');
}


function updateDisplay() {
if (currentIndex < prizeQueue.length) {
document.getElementById('current-prize-name').innerText = prizeQueue[currentIndex];
document.getElementById('rolling-display').innerText = '等待開獎';
} else {
document.getElementById('current-prize-name').innerText = '活動結束';
document.getElementById('rolling-display').innerText = '恭喜';
document.getElementById('drawBtn').disabled = true;
}
}


function toggleDraw() {
const btn = document.getElementById('drawBtn');
const display = document.getElementById('rolling-display');
const bgm = document.getElementById('bgm');


if (!isRolling) {
if (members.length === 0) return alert('名單空');


isRolling = true;
btn.disabled = true;


// 播音樂（關鍵修正：用使用者點擊觸發）
bgm.currentTime = 0;
bgm.play().catch(()=>{});


rollTimer = setInterval(()=>{
display.innerText = members[Math.floor(Math.random()*members.length)];
},50);


setTimeout(()=>{
clearInterval(rollTimer);
bgm.pause();
isRolling = false;


const i = Math.floor(Math.random()*members.length);
const winner = members.splice(i,1)[0];


display.innerText = winner;


const rec = document.createElement('div');
rec.innerText = `${prizeQueue[currentIndex]}：${winner}`;
document.getElementById('records').prepend(rec);


currentIndex++;
btn.disabled = false;
updateDisplay();
},3000);
}
}
</script>


</body>
</html>



















